---
# Configuration d'External DNS

- name: "âš™ï¸ Configuration des annotations par dÃ©faut"
  kubernetes.core.k8s:
    definition:
      apiVersion: v1
      kind: ConfigMap
      metadata:
        name: external-dns-config
        namespace: external-dns
      data:
        default-annotations.yaml: |
          external-dns.alpha.kubernetes.io/hostname: ""
          external-dns.alpha.kubernetes.io/ttl: "300"
    state: present

- name: "ğŸ“‹ CrÃ©ation d'une liste des domaines gÃ©rÃ©s"
  set_fact:
    managed_domains:
    - "nginx.keltio.fr"
    - "blog-newsletter-manager.keltio.fr"
    - "vault.keltio.fr"
    - "vault-k3s.keltio.fr"

- name: "ğŸ“Š Affichage des domaines qui seront gÃ©rÃ©s"
  debug:
    msg: |
      ğŸŒ Domaines qui seront automatiquement gÃ©rÃ©s par External DNS:
      {% for domain in managed_domains %}
      - {{ domain }}
      {% endfor %}

      âš™ï¸ Configuration:
      - Tous les Ingress avec annotations external-dns seront automatiquement synchronisÃ©s
      - TTL par dÃ©faut: 300 secondes
      - Provider: Scaleway DNS
