---
# Main site - orchestration of all playbooks

- import_playbook: playbooks/00-prerequisites.yml
  tags: [ prerequisites ]

- import_playbook: playbooks/01-k3s-core.yml
  tags: [ k3s-core ]

- import_playbook: playbooks/02-k3s-applications.yml
  tags: [ k3s-applications ]

- name: "🏁 Complete deployment finished"
  hosts: localhost
  gather_facts: false
  run_once: true

  tasks:
  - name: "🎊 Final deployment summary"
    debug:
      msg: |
        🎉 K3S DEPLOYMENT COMPLETED SUCCESSFULLY! 🎉

        📋 What was installed:
        ✅ System prerequisites
        ✅ K3s {{ hostvars[groups['k3s_servers'][0]]['k3s_version'] }}
        ✅ Helm {{ hostvars[groups['k3s_servers'][0]]['helm_version'] }}

        🔗 Connection information:
        - SSH: ssh root@{{ hostvars[groups['k3s_servers'][0]]['ansible_host'] }}
        - Kubeconfig: ~/.kube/k3s.yaml (downloaded locally)

        📚 Useful commands:
        export KUBECONFIG=~/.kube/k3s.yaml
        kubectl get nodes
        kubectl get pods --all-namespaces
        helm list --all-namespaces

        🚀 Next steps:
        1. Configure External DNS with your credentials
        2. Install applications (nginx-test, blog-newsletter-manager, etc.)
        3. Configure domains in Cloudflare

        🎯 Your K3s cluster is now operational!
