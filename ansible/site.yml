---
# Site principal - orchestration de tous les playbooks

- import_playbook: playbooks/00-prerequisites.yml
  tags: [ prerequisites ]

- import_playbook: playbooks/01-k3s-core.yml
  tags: [ k3s-core ]

- import_playbook: playbooks/02-k3s-applications.yml
  tags: [ k3s-applications ]

- name: "ğŸ DÃ©ploiement complet terminÃ©"
  hosts: localhost
  gather_facts: false
  run_once: true

  tasks:
  - name: "ğŸŠ RÃ©sumÃ© final du dÃ©ploiement"
    debug:
      msg: |
        ğŸ‰ DÃ‰PLOIEMENT K3S TERMINÃ‰ AVEC SUCCÃˆS! ğŸ‰

        ğŸ“‹ Ce qui a Ã©tÃ© installÃ©:
        âœ… PrÃ©requis systÃ¨me
        âœ… K3s {{ hostvars[groups['k3s_servers'][0]]['k3s_version'] }}
        âœ… Helm {{ hostvars[groups['k3s_servers'][0]]['helm_version'] }}

        ğŸ”— Informations de connexion:
        - SSH: ssh root@{{ hostvars[groups['k3s_servers'][0]]['ansible_host'] }}
        - Kubeconfig: ~/.kube/k3s.yaml (tÃ©lÃ©chargÃ© localement)

        ğŸ“š Commandes utiles:
        export KUBECONFIG=~/.kube/k3s.yaml
        kubectl get nodes
        kubectl get pods --all-namespaces
        helm list --all-namespaces

        ğŸš€ Prochaines Ã©tapes:
        1. Configurer External DNS avec vos credentials
        2. Installer les applications (nginx-test, blog-newsletter-manager, etc.)
        3. Configurer les domaines dans Cloudflare

        ğŸ¯ Votre cluster K3s est maintenant opÃ©rationnel!
