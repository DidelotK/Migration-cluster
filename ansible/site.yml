---
# Main site - orchestration of all playbooks

- import_playbook: playbooks/00-prerequisites.yml
  tags: [ prerequisites ]

- import_playbook: playbooks/01-k3s-core.yml
  tags: [ k3s-core ]

- import_playbook: playbooks/02-k3s-applications.yml
  tags: [ k3s-applications ]

- name: "ğŸ Complete deployment finished"
  hosts: localhost
  gather_facts: false
  run_once: true

  tasks:
  - name: "ğŸŠ Final deployment summary"
    debug:
      msg: |
        ğŸ‰ K3S DEPLOYMENT COMPLETED SUCCESSFULLY! ğŸ‰

        ğŸ“‹ What was installed:
        âœ… System prerequisites
        âœ… K3s {{ hostvars[groups['k3s_servers'][0]]['k3s_version'] }}
        âœ… Helm {{ hostvars[groups['k3s_servers'][0]]['helm_version'] }}

        ğŸ”— Connection information:
        - SSH: ssh root@{{ hostvars[groups['k3s_servers'][0]]['ansible_host'] }}
        - Kubeconfig: ~/.kube/k3s.yaml (downloaded locally)

        ğŸ“š Useful commands:
        export KUBECONFIG=~/.kube/k3s.yaml
        kubectl get nodes
        kubectl get pods --all-namespaces
        helm list --all-namespaces

        ğŸš€ Next steps:
        1. Configure External DNS with your credentials
        2. Install applications (nginx-test, blog-newsletter-manager, etc.)
        3. Configure domains in Cloudflare

        ğŸ¯ Your K3s cluster is now operational!
