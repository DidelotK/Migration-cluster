---
# PrÃ©requis pour les applications

- name: "ğŸ” VÃ©rification qu'Ingress Nginx est installÃ©"
  kubernetes.core.k8s_info:
    api_version: v1
    kind: Service
    name: ingress-nginx-controller
    namespace: ingress-nginx
  register: ingress_nginx_service
  failed_when: ingress_nginx_service.resources | length == 0

- name: "ğŸ” VÃ©rification que Cert Manager est installÃ©"
  kubernetes.core.k8s_info:
    api_version: cert-manager.io/v1
    kind: ClusterIssuer
    name: letsencrypt-prod
  register: cert_manager_issuer
  failed_when: cert_manager_issuer.resources | length == 0

- name: "ğŸ” VÃ©rification qu'External DNS est installÃ©"
  kubernetes.core.k8s_info:
    api_version: v1
    kind: Pod
    namespace: external-dns
    label_selectors:
    - app.kubernetes.io/name=external-dns
  register: external_dns_pod
  failed_when: external_dns_pod.resources | length == 0

- name: "âœ… PrÃ©requis validÃ©s"
  debug:
    msg: |
      âœ… Tous les prÃ©requis sont satisfaits:
      - Ingress Nginx: âœ…
      - Cert Manager: âœ…
      - External DNS: âœ…
